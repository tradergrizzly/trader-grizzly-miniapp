<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Trader Grizzly Bot AI</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
    body {
        margin: 0;
        background: #0f0f0f;
        color: white;
        font-family: Arial, sans-serif;
        transition: background 0.4s ease;
    }
    .screen {
        display: none;
        height: 100vh;
        padding: 20px;
        box-sizing: border-box;
        text-align: center;
    }
    .screen.active {
        display: block;
    }
    h1 {
        margin-top: 40px;
        font-size: 28px;
    }
    .sub {
        opacity: 0.7;
        margin-top: 12px;
        font-size: 15px;
    }
    button {
        margin-top: 30px;
        padding: 16px 20px;
        font-size: 16px;
        border-radius: 12px;
        border: none;
        cursor: pointer;
        width: 100%;
        max-width: 320px;
    }
    .btn-blue {
        background: #3aa0ff;
        color: #fff;
    }
</style>
</head>

<body>

<!-- –≠–ö–†–ê–ù –û–ñ–ò–î–ê–ù–ò–Ø -->
<div id="loading" class="screen active">
    <h1>–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞‚Ä¶</h1>
    <div class="sub">–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é —Ä—ã–Ω–æ–∫</div>
</div>

<!-- –≠–ö–†–ê–ù –†–ï–ó–£–õ–¨–¢–ê–¢–ê -->
<div id="result" class="screen">
    <h1 id="resultTitle"></h1>
    <div class="sub" id="resultSub"></div>
    <button class="btn-blue" onclick="nextSignal()">–°–ª–µ–¥—É—é—â–∏–π —Å–∏–≥–Ω–∞–ª</button>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

// ‚úÖ –¢–í–û–ô NGROK (–£–ñ–ï –í–°–¢–ê–í–õ–ï–ù)
const API_BASE = "https://scleroid-measureless-kaya.ngrok-free.dev";

let currentSignalId = null;
let pollInterval = null;

// ====== –ó–ê–ü–†–û–° –°–ò–ì–ù–ê–õ–ê ======
async function requestSignal() {
    try {
        const res = await fetch(API_BASE + "/signal", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                user_id: tg.initDataUnsafe?.user?.id || "test_user",
                pair: "EUR/USD",
                direction: "–í–í–ï–†–•",
                expiry_sec: 60
            })
        });

        const data = await res.json();
        currentSignalId = data.signal_id;

        pollResult();

    } catch (e) {
        alert("–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º");
    }
}

// ====== –û–ü–†–û–° –†–ï–ó–£–õ–¨–¢–ê–¢–ê ======
function pollResult() {
    pollInterval = setInterval(async () => {
        try {
            const res = await fetch(API_BASE + "/result?signal_id=" + currentSignalId);
            const data = await res.json();

            if (data.status === "done") {
                clearInterval(pollInterval);
                showResult(data.result);
            }

        } catch (e) {
            clearInterval(pollInterval);
            alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞");
        }
    }, 2000);
}

// ====== –ü–û–ö–ê–ó –†–ï–ó–£–õ–¨–¢–ê–¢–ê ======
function showResult(result) {
    document.getElementById("loading").classList.remove("active");
    document.getElementById("result").classList.add("active");

    const title = document.getElementById("resultTitle");
    const sub = document.getElementById("resultSub");

    if (result === "plus") {
        title.innerText = "–ü–õ–Æ–°";
        sub.innerText = "–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º —Å –ø–æ–±–µ–¥–æ–π!";
        document.body.style.background = "#1fb950";
    } else {
        title.innerText = "–ú–ò–ù–£–°";
        sub.innerText = "–°–¥–µ–ª–∫–∞ –∑–∞–∫—Ä—ã—Ç–∞ –≤ –º–∏–Ω—É—Å";
        document.body.style.background = "#e5533d";
    }
}

// ====== –°–õ–ï–î–£–Æ–©–ò–ô –°–ò–ì–ù–ê–õ ======
function nextSignal() {
    document.body.style.background = "#0f0f0f";
    document.getElementById("result").classList.remove("active");
    document.getElementById("loading").classList.add("active");
    requestSignal();
}

// üöÄ —Å—Ç–∞—Ä—Ç —Å—Ä–∞–∑—É
requestSignal();
</script>

</body>
</html>

